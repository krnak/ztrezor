#!/usr/bin/env python3

class Reader:
	def __init__(self, data):
		self.data = data
		self.index = 0

	def remaining(self):
		return len(self.data) - self.index

	def get(self, n):
		result = self.data[self.index:self.index+n]
		self.index += n
		return result

	def compact(self):
		b0 = self.get(1)[0]
		if b0 < 253:
			return b0
		else:
			n = 2**(b0 - 252)
			return int.from_bytes(self.get(n), "little")

	def uint32(self):
		return int.from_bytes(self.get(4), "little")

	def uint64(self):
		return int.from_bytes(self.get(8), "little")

	def int64(self):
		# ???
		n = int.from_bytes(self.get(8), "little")
		if n >= 0x8000000000000000:
			n -= 0xffffffffffffffff
		return n

def parse_tx(r):
	return dict([
		("header", parse_header(r)),
		("transparent", parse_transparent(r)),
		("sapling", parse_sapling(r)),
		("orchard", parse_orchard(r)),
	])

def parse_header(r):
	return dict([
		("version", r.uint32() ^ (1<<31)),
		("nVersionGroupId", r.get(4).hex()),
		("nConsensusBranchId", r.get(4).hex()),
		("lock_time", r.get(4).hex()),
		("nExpiryHeight", r.get(4).hex()),
	])

def parse_transparent(r):
	w = dict()
	nvin = r.compact()
	w["inputs"] = [parse_t_input(r) for _ in range(nvin)]
	nvout = r.compact()
	w["outputs"] = [parse_t_output(r) for _ in range(nvout)]
	return w

def parse_script(r):
	script_len = r.compact()
	return r.get(script_len)

def parse_t_input(r):
	return dict([
		("prevout", r.get(32).hex()),
		("previndex", r.uint32()),
		("sig_script", parse_script(r).hex()[:20]+"..."),
		("sequence", r.get(4).hex())
	])

def parse_t_output(r):
	return dict([
		("amount", r.uint64()),
		("pub_key_script", parse_script(r).hex()),
	])

def parse_sapling(r):
	nSpendsSapling = r.compact()
	vSpendsSapling = r.get(96 * nSpendsSapling)
	nOutputsSapling = r.compact()
	vOutputsSapling = r.get(756 * nOutputsSapling)
	if nSpendsSapling + nOutputsSapling > 0:
		valueBalanceSapling = r.uint64()
	if nSpendsSapling > 0:
		anchorSapling = r.get(32)
	vSpendProofsSapling = r.get(192 * nSpendsSapling)
	vSpendAuthSigsSapling = r.get(64 * nSpendsSapling)
	vOutputProofsSapling = r.get(192 * nOutputsSapling)
	if nSpendsSapling + nOutputsSapling > 0:
		bindingSigSapling = r.get(64)
	return dict([
		("nSpendsSapling", nSpendsSapling),
		("nOutputsSapling", nOutputsSapling),
	])

def parse_orchard(r):
	nActionsOrchard = r.compact()
	if nActionsOrchard == 0:
		return {"nActionsOrchard": nActionsOrchard}
	actions = [parse_action(r) for _ in range(nActionsOrchard)]
	flags = r.get(1)
	balance = r.int64()
	anchor = r.get(32)
	sizeProof = r.compact()
	proof = r.get(sizeProof)
	return dict([
		("nActionsOrchard", nActionsOrchard),
		("actions", actions),
		("flags", flags.hex()),
		("balance", balance),
		("anchor", anchor.hex()),
		("sizeProof", sizeProof),
		#("proof", lenr.get(sizeProof)),
		("vSpendAuthSigsOrchard", [r.get(64).hex() for _ in range(nActionsOrchard)]),
		("bindingSigOrchard", r.get(64).hex()),
	])

def parse_action(r):
	return dict([
		("cv", r.get(32).hex()),
		("nf", r.get(32).hex()),
		("rk", r.get(32).hex()),
		("cmx", r.get(32).hex()),
		("epk", r.get(32).hex()),
		("C_enc", r.get(580).hex()[:20]+"..."),
		("C_out", r.get(80).hex()[:20]+"..."),
	])


if __name__ == "__main__":
	import sys

	"""
	try:
		tx_raw = sys.argv[1]
	except IndexError:
		tx_raw = input("tx: ")
		print(set(tx_raw), len(set(tx_raw)))
	"""
	tx_raw = "050000800a27a726b4d0d6c2000000000000000001dc754d63eff4698ee321476872519c53f14cfe58c9425c7ee464c206461ef5aa010000006b483045022100965a6dace3352ff95517f106cdbe543b536e7a5ea7a87d54824ced08979f49ba02202704cdf8d37edc0bbef4535183368ad6b9ac1ab64dce5f1e30b3757b8ba496060121030e669acac1f280d1ddf441cd2ba5e97417bf2689e4bbec86df4f831bf9f7ffd0ffffffff0100a3e111000000001976a914a579388225827d9f2fe9014add644487808c695d88ac000000"
	#tx_raw = "050000800a27a726b4d0d6c2d6471d0009481d0001d96df55e50df3376c74628a607d11705c7b97c489deea8e4468e81ceac257315000000006b483045022100e34b8d569936642aadb1c6bb1eb8c18681d87bba65ae58eaea67d059981bfc6002203491bf35dafb1392ca9584fd4c084dbeae7fc33880700129f494e28b13814d6f012103989aeaea4f4a0db4beb351824df15b44baf118fe9a3e2b7df014498a1f11bffdfeffffff027237040e070000001976a9147e193c7c8292421033cb9051307b22466583a67b88ac00e1f505000000001976a914a579388225827d9f2fe9014add644487808c695d88ac000000"
	tx_raw = "050000800a27a726b4d0d6c2000000000000000001af82135d9fb797c1f8683e7455982e883d5a2a93f240ae6cf6ec320445feb651000000006a47304402204a8af453cfbe124c7ccf8b8f410195852770bd39f059480be2cc79b58fb767d802205e6c02b8be69eac803482b4e551f7f666fcde2d82453d2d1e65e1421afb165220121030e669acac1f280d1ddf441cd2ba5e97417bf2689e4bbec86df4f831bf9f7ffd0ffffffff0000000273377026d1e09516fff0d8624d1d3ffe944e1b42c533eec1fcb46395cd36ffaf9dfd3dab606a75cf83e079376f21304618eecfa392ac5d1a4bcae6a1f6279236e4a5bd7b6573f04a917f19a093ef36fa0305f41dea52a7bed9d61757a109c52c993a43674fb73aa755e25ba4270f78400b2b47132f82e0e02406b116a1455e20840731b0db9e9d6f8f8f849e882ca7e0137e02820295efdfc7bc01f384c2b50e068a053a112f6ea468439d9d20f4ca9b7ba37278dc7f66fb2a7806462e1e03cbe69375cc8d797e079817f5dc314c368e803302cc4c7b6284843451b487ddbf5795acfccd89d324e97d8b3e32a77e35b4c5dae86993d34cbdeef60b220a788285eca68f5c42f72e41a30d947b5cf2e2c83a7dde06ca5b188bffe8506e27db25ffb78ad952b18ea6502148af7cd643869f2c2cb6eedb77aba0016bcbce32b93ae4d10d0a362d517b93f447e089e3ad71464e1744763fc14ea0832e931c320299aa3131f2b4bc29ce6e7f3d205c64aa3ecc74527e10bea04f0b11dab180e6cbcc0009291f075a5d5ab2af441d2671e0a7d8056f569dfcdf482798a69b1b8bdaf34f76ac25b641f2d76244bc7c7c069dcd66bccb0b67e86c8ce933a462c0716002ef585cbe50376affbbe01388d41a65d5ebc2f36a699ea6efa91a3056761c9f9f1de123e0bad29f984e1b36b7f34bd29b1e194888d8ffa3310c1f44207e88da63b031651a86022985345b1dc90441699445a4dd927bfa00c8e717e2d12962bd0a811517363c49bd4c6dddb60659ee11bbaa720664edd6d985d88775532141a8723eccffb2e1d8a853ddc3bcfe894435c528a226fb2dd617a05e2a838ecfa7293b2323f29444c0cf6feffbf4f1c221a75f3f61ccecc297e7cbb7d90ba77e777401972a5a7b7db59335c4f5eaf75903ae2b5a57d218345d2ceecf6cb5159e51f338fe7c5754818f55b8294e5e153329bf982981877d102e18bcff1e460ee8c24f59d2b7bda566407d3735505e6aaf46f065b318c9424b6cc59408d2b65ffa09eeba458f4fd938db67eee1d7e1c1bc4695ba3af11345b43b327f6002329225bcdae9bdd6135f3b8b4717e43e45fb51bda4a0810df410d1c2ed3b72e544a05afa85862a2f4d7f5fac929410c39613716e682605f79fb7ba460b2ebe5747c686c8281f7ee21a34b8eaf62fd66aa217bdb4ff778642ed37b154acb0f560f55c17bfb917595b0844011d26807cf66571a59183d6848c46fb24391a7a7d9928e7100569ae65a92ab924dafc63a8c163311ed987af6b82f52205bd2ff64f29c4d47fa138cb53b03210898d4d18f9202f49ccc90974f5be680e1bd515b8b2cf595eb2fcf93ca310aee2c6c73566ff90d59a916bd6b3a005c53b992907f0dc8f77fbc992f59e2a4a53b32f13597b0a4089694f2b82d63a2374431589c8c1d785bf5bb1e25c7ae3f3139d2a686adfce8ab70136336045a73431aa10cfb5e4624ee1e93badd46f2384b21b238b5faf97fd011c821b2f279aa231cb0fe278e4ce3d76d8264c9bb26d1b26a6a46b022a3d6b5036c70b7a76bc772e1fd6ee2105d981a68a914517d35d2c4b9f5771e6f2f859152485ae50c3b689628f22c06afc47a3aa3bb9b54e7a59f3109e72fc680db8225615ab40196a173415b665c38fa973cde9451aaec484c98726597c342028b3a1b0b32b17d06331f2e51bca44bf26e33290b48471fd825cd03fc27f6ccfad8e61f2f246ca333296772ba8d2bac5174215899a6c26c8eb9c5aa0b55c77951a24eb3395abf368bf0f2e0b04d658cc95740fcf33eb24f982f93dc4ebe1d81282b6bc93a60536a8713b6bd731133fa1fd5ef809168bfb6195932defeb9ab14b0d525acdf07d0bbe766836b1783b362d91d57357e79d040d992f8f0af216196c754ef34ed8dccb3e011f91d730d3bf19077782b23b67c5c6717568cb6b3c2a7bb5665b930ebd8d01360cb6631a8c82fac86286c9622e16b90b9159cbc6c4aaf2ea0f909ccd9add98d46e0e4b5dc8456a1f5c759f2da9f23f0bb26c8a9f7943ad8880a0c266b0989a989d34c2a8afaa6fdf43a1a8abd162f3faf26373c8f7cf5645e9715a51fbe48a872d8d7053f4f498262ce95f8592ad228a2038a7d7880cfa3353142d57c117e417f212a3ff371ccf3a6dbc07ea37e0835f02945a1d92b043f10d3cdd53f39f3f4baad51a92f51fa5a1d52f0a165c028b5cf9468a1dfb5e72340597177bc02888fe45efd5b80e7db1997c7ce72a19cf2af54ac2a082646fda29ebcdb127951de48e1e8385066de0e5f1ee66b691350f64bf93d645259606a829320310460afaffffffffae2935f1dfd8a24aed7c70df7de3a668eb7a49b1319880dde2bbd9031ae5d82ffd601c7ab0e5657bf7fc1e14c52deba1766755b5861708ab28b9148a31cd4da40faeb4ff817359b81b87a1c786f753d15471767c538674e8c7d558837059073a3ae0ade8f7a4391dcd1179d5c77940b059c2367a64c21793e5618078a47ec37b2baaacdc51b55036a5ee32c976a705e6af82089b99ff9a5ccbd88f5f280032c3e4c22a42bd98830464be4c4aa3ab5cd26e7c680b07aa7244f31701a9ae21ea7e3995943ba61e660dc532151c73131f1345aaf54fd1c340e049a67c2fcc9f4d5415231a586ead4f49f709d19c9f08cb28321954e549eeae0e03fdd3186489de034b91a9a14c4aa3df39e9f2c796afcaa496dfe7b5e3996d66d6bcb5301bb3cbf8cdbe097be7a138e8ace74ec52784ec3e0c703a9db625eb5978c4940e27b4ff5a627ab79f19c713a1b8893dd2100773e1850aac342bbf865da8aec38659a0d7bf59ea84bb7b42ce6620868c0040d314605d80feb01487bc817cf13b65066abab1d5f71c2b2e4180ea32dc21bf08ab0ea1436d3d6818f28f2a5e6b02ea11978510212010929ee11de6ffc7b49f1b7f348386fd8337e91d60cffeedac963a42b24ba1f03e7c3421cc216530b4169d5cf744bbb72c385614efd223ae126560bc4857e9d990e2aae9db5fa4beeb2532ea03ec30deb3aaba67f54aa46b225ea12c5e015fc92c7abf264bdb605b3533b8a7b77db398e2e24461f303ec67f4acc4a8d71654f02b0a9ac176d5e20eed859a0f86425d1a81f6c26aee6905234fdb7e83787ee91b877c83c1d48607915e5de9e27cccfa033b3a26e159634d8879bc25bef374b5ee81d9a6234969ed91635a910815c925cd93471bdcc655a6bcf20b418d49ef27f82216263b137fe6cfd5eca9a62a2e40be58a81ffc8fdba243146518770a255bada843aa4c2f1c8f6d09bfb69e66141e87b9ef62f53c1b841c1e24a05aae2a06c039e4f796f9730986ee1e2bf0969e2002c1cec1aef748173c53c0a185cafa332cae3ff9e5704e7868bd9a9939ddb0b77f1f181dce3680dc531d751e369e45bebe98602ec929760f9f53560b7e1a117cb88ac54ceb4b79b960226c33cc01548fe031f58bebd8981f410310f6a3d4d89abcdd31a5632e6fbe3248e9c4cc6fb40a4abb6cc2b2fc9c8afc6cb6edf0ac846c13523849205493e37624ff61a047d08cf434ca401ab9eed571acd4d34904613f7c285a97eb02f41bfc7b916b5138fe1f2b08d3d5aaa519107b2940b99ce9daa5d6e287836594cad71cdf20c1aa39d75d938c080ca9ee6236797ac4cc8d2982480cf8f4e6671cd04618db9f0d24a6ff6d7d3168517faa00b207c8f0a52edb982fe5324e68f3595274117a33576e40a1c59f09b0d181c920ebcef8afc60070067a06bbd44479191e0dd5b0e1a1cff024281a3cc2f4a1e2289dffc99aa26abc5b56094b6f756b4f09c2793a3988309782a4151165614bd2e77c9695fdf1b9671ffb17e5142f27ba622b3abf3c1ed49f95a08681664a50409330fd93b4eec1186fa8b5366e621a8d68b2cabfa9255e78e3439422329957fa6a132e1714e1ff4dff3eab1fdc7d6729baa804b76eb11954a257311ab128a84b6ce996e10db385ba9a4c60bd33948693be24a328a015d7da61fdf02c021b4c745bc058c811bbe645137ae24fb5b4662447159295be821db0d87710af256305d88c7ba0bf78a48584bef409f85f0a5c0e78399b9466e231fce858c3835d4b67e02adfca0d3f3f1803b5ffacd8b273aa9c57e1b5586ab60522fa0b0390f497b3b548da238278eff451c536ead93fee745341321fad97dbb6e69562ca38549c4e6b6c336b7f1697a700cb64418cd599a03b169134bfb594655d91ec3505cdbc9a856ae6b5ca6047dc7c9a36e25237b94d83a4a78469a8ee4941566cceba335bad2a242638c55519c31a320b0a289ff60c0d6ef39b2bbe135dd881293700ecfa84bc476cdaf4fe51a8147eb0f43995861941dc79b398d8333f1693a55e8aa8d9c9c1bc105a8755ef30332bc3a57bf7439cdfa2e2be1f061b80aeec4e979215db3f0d19d05f942a4ddfa0ff0fd1c2ff16ab88199e6ca89a0cf35c30d4b983998653162887b17ce1cadc4df3dd3c8169fa419c6e29631caef526e8190b8037e8c2e7b5904ca2ea8b6b010de46490837b58c0c7ea793e7a775355c38b4147bb10e5f733d001a1f1936ae3e1424a1b4c1bcf1c964ed05916146a033a877d2f0e1fd991920bb09322c23f51c00486ddb3e678c3b05616f53f5e498c3121f1a312b441d8e7eff26ceafb9070d397409d406c4d0f18e2f21aad54d5fbb41c18c01a984aed54e041de93e70bfcca73131cc1621589d75bba3e7142b78ee129338e1247c8ef109dcc047722b0667bbc08e3635ac34e3cea6b082b54ae1e6272fe1722020c775acca3baca4758f68e11c48f651b0b544cc675de07a63ec680c786723b7968e6a422d9fb1fb91bcb0cf02a7de070ca3d89b1f842516789c7884aeccb2dca08a0f7c41a00b12b18c5c7091f7362985dd443797d19d173e4a1221e920a078c18d13092473b63f2602712bd7ee846ed2bed108696384c3bed872010032f2dd0c7d6c3daae79f3d289fcb8c2aa0a71783c06bb60beda97b99f4e5ce09fca0e244601ce1c088e31789bbae944036d80f03365f53229cf30f64484ef3a053231c40976a056c34d50343c0f4170b6ab448141e2c0667cc35aedaf76a6195e7f265d9fab8af2b8a5e6efbc3f584a5ec4cf8c311717f125f92b7cd7ba14ec13803fa76d2dbf7f2f4984d159a75132eb2fcb0633ac79f3ecd58f64babdecb61f920698420da538a980f0bd958a860b79c9ea4a8e3bf3ea613546249ae05603746f089daf056238190698166ebde4f097f8abdbae53435d3a4920546ea0d8ae1ad52c5abb2d15f22f3566941938468a475d0c9961956d24382aea213d77ecc782703ade3986754503ad572ce7106404073030090f8a9857f753971903df078294540c8920344b4c7112bcaca9c5fb85748c631a49233a2cf8f515080907df75c60428ca7028e5ca8888c66d60ebaed137ba405ba5935ec16e4ed5484dd880fd5770031db4f842363e9b03e33585b0d3e31d54d463684e929e592ac21e8eff135e0d1af0d1b9ea35c474a2571a0a9f6d9b2e88a3712af34eac9d0e6af141381bb8b725b8ad1b16fa5d45f5a19f7988d0ba9e9b887d71db3a29faa7d0c714f0d5b95f32d2b90d3aa97dd2fc9e8c5bc55dd5c20fc534e1a523ae6408d4de74bb9e91a72d17360f562512613f4d8baa8c688c63c3475c8ee71cd73d1ef30e01667f519a3295955575baee9aab73be2de2df8a717a9bcf94faa3d844ed30f0ca577b5a911b318d30dac98d7423f9d16bf7f46ec41930a070038f8f955c346daa031b2bbd381770ce0669d7a5bcf350400a605470ec887e8027a5adf1e487e66eb6855c162494d31375707d5961cf3de99f07a2d48f9f937deac2dfdcec94c0731c368ff6125181b8eb998605a1f986aa17db49310684311e4833f2ec6878372830246600250cbe1a100816f0aace17ed62b3799e31adb19edfd2d7f8574abbd9117a96f2034b40e58ad8c91f811df04f3a9636463da5c4a2a02c388a8d667673e0f7a23622eceb6971226c7a4c8bdd91f7d58922f7773abfaa4d933104877e48607fdf293ccb1304863a23ed2666d6d418cbe3f2a25d7efb4b067b9f60ebde6b2a1ba8c611e9198f92b8e9750f32fda67fab7a71d6619e977dbc9d7666c82d7d70bcc2b32e50393a7410e707732188b82afcd1bb998a9acbe744405ce62c309d3647952322b37a5bdd49e8cc82c9948ca19d460466ca232e933f8055bf383bde3eff6dc01855175ac31bb45e006159f53f907ad9d49878ff54e6a9f30120b969f18d754a0581f86d37e6ce6c4263750371d180aa13e49eaed5f73a613dd2adc1eea4573d3aa744726ce90dadf9e5d495423dcc5ab42d551b974220e3310fe60e2226de980f1f8bfa7b35627fbed6c20afb74e500f5e567289c16acd6bab7bc265d0e60ea0efb7eaa63d6f92d13b11651531ce6cbbebf745e6b2aa9572e16a9cfaa5cdd01218e50307e7fedfa40a3a95b177295b91ef0b1ed4817caa216e20ff276f43ef419d8a903db0fada8af804f4d458a139d0997d5c3e6b0ea9775316c6d310a019f346649d6046482312c0b7330afc4fb55d6a4eebb06f866d97ae5a12fc77e99421b68e9112d22401909fd86d46ef6b447661c4bc44a2b0bd74a746ca30e56157e36b061c0bf0ae8806986670b3b3394b0c2aa6e50c31ec7d59e5fc1b6213f04ab25f9724d274b7d8ca2a1c2f66702714fad018fa9ac06603629c3fba52199c45d26749e93ad545e9fca79e420591f5137126d7423661eab5653f106dad420561f1422554e7b7aaf3cb1adfdef73071272e475ee1a2142ad613b89a4710665d0be1e82bcd2bb52e19590231dac12e340520cfd8fcbb84467ebd4dfd858358427e10143ae06912650094191fd71b0b2dcc3fd7c8a3afb18b334b28c938a485b34690d770ef4e1366b39b9e20ea4aa8ae6a0697826847da8c14fcbbea5df24cae258070376a434ea46e97ec3ddd22d6e3086605c937d6296150b15f39e982f32efb93dd3cee45bf8ef795b4abda57b748940321c40b438f7c3b165442ad42bfc81063f58b5324eae0c05013f9647707c821a2ce5164649e4d4c25a36daf38fe14052274a7978ae4b98e31076fc1324649a04d0fd38018eaa122fa897c1e263009f9e3d14d20c6a248ca3b5cf4bf941b29c36b0ee4d29c75da30bde5906b8438a60862c63d54ab0d8008d954f534efc2cb5a4a9f48a5fb862edd32918240d27943d753a26ed0a49e56b090d114e6cc465841080359ca878db4084b089fbf26b2ee29d19b479cce6c3fa84d59b40ad5cc3023e4d127e6c633bf155c63d40c17d45629817da0f3c1870db91776f6902eae2c3f4592f8813d1dd9da1ecaa1a390585160236766e83729f4aeaf012bdc8630da43a751fe4d0f4c05f73ca6b237a51ca668c22510df54339986779482f4891e51d6710a068949e848a3f943c5f471dff0124276b340124c36d9601b9fcac99f0f37944035547e7e190c3261edacdf069063c2c501c799a0508c878464e6ffe0f7ca146717e07151e4936168550e58c10e0133ccd2ef276d7cd9a674628adf705b12facca063234e3b4c4050ae15c5c441ac51fb03fb7378b73f6df7996dd6c50e652547ce852a7b19f9e67e2b23da1579e5d1a0e1596f054026a78c505ff72599638ae8cdcaaa68a33985c14c73beaac0fba110a3de44fa4f2313cb0d725c38b7bffbba8c9fae0ce5d70cb5418dd409302b50f9a1576f71cf3f81fbbbcf587a4f33043be9af92ea8dd878d40d664b01a53101ba8eca60638e37947eb08e585447b58be4fa8bccfb8144eeb200a507efb4a480eaea8332e45b3997ee8f3a9f6725458b2893c7631fbb2e1656327320e394602273cd34d36c422b8d50bfa857b88e020c8790a2c4adc0deb3f94149780ffa7a0387da4ab4097315e4718cdc535a948c7f4818f849403961751fab4a0fa9512c70224b92349eaa8eba115da7ef3bab8c08b787d962fd84c95474a7c93940d2ce914c765ef39fa9d50e76f27d77a78e3b3dda1f2c0bb80e250211b84631a9209c2222200ea3c120902b28ee97fa70b8c27e8cc41eb8f3aedd3d88bef5fa1a817271eaa7933cad9bf0bda195af6635f54250db1780d3df642d22ff84660bd345928053ff7be5fa8b7c7a7cd3e4ae55ab42c34f8139824a6addc7f6ed8f1a9de9e1e0201f784dfacc866a37843c16874ce8d2654904cd4a99e0fd72a1fb04fcdfdd8308a3a055ce6dbd23ab9688f5f5b5b9c525798a5aee5f2012438ca9e3da3bd6e2095b6e579631228547160682743fe87649c858a832ac4e0313150a98b307fc10798319094664527348fa65a6b7ace35dab242d34c162095ec5246424a0db5d238f33d6850ee363dfba5b65b75652e8b030824dc7311e611127402ac9691e9be36e9c510bc005e0bbaad3e88590d9e7dc550ac7d5bc595e9a8ac32f7d499a1fa1eafc0c3bac55b9ef694efe1b66c73ebf18d66091a62da450b6f54f3e1242c021a0d6aeaeeacc9b2b47ee87b5e9e10794ce764406237984beafdca9065e047ea0e9ea8494e3e10ce7d26b18b45b90b5472a7e572d830e24fb34feb9c559a9e17394c40bc6d0ce5706d1a8a78d81c74e7fb3c6b05fb67fe810e42aaa921c626e31477d9ac6b08b05a11906fb1fe1e0c0dc55d83023b3547b90f326ae63316a0120bfe8528ea0442057ccbd15f4b2da5229b4f3fc47dc60385bdccf2d03a6fb12e34cad8776f950eb91e5f2f2cb063921a0279e39a539f17aa4ce7eb36259d4d5b022aea8722cd9de518008fbf6c7ffe053df0c8aa16860d386f83bd756a2833d71b308f4f5c67ff308542dc890160c9910e9b3807c9699b6fd75d0948a337cc430dfaa4d32ad7c92711a9675bbe19f7bb0ced86e5c2013a62f9c915adb9dc9a75345e2ff2874884e84ccec58adac8180e5f38cff1af5aa4ccd7655b11af4933bf2745c85bf5be0e2cf2fc0395b101a2c1ccbfd66acd37107805674cff3eda5c4c147cda5f23522d1480a1f6d318dea269784baeb06250b69b46f996c9652bb2110435eb049719cc82321d54684ed86513613d79e1cf022fdaff97251eece74f802ed1b70b75560246539d77a3f35ca3a2df6effc0a4f058ad2a6b75f5085f06d035f2987315a0b04b71be2bb5d265ec0e61b495e76529e326ef0b60c948fc7a2338deac8cf90994afe97bcc5a4731745ca14de594c4ac2ca91fa0e39a4eac83c10bb7bf78e5b865dab88efdd0fe577779246037304e710c7beb58a24b2c4f0fd7255c782d8d4aa4493019024f54c034e7c67a6ed3ec3fa14c16c6592014e866a4324ec5c0e50fd67ff57c86af3d54f9440b4faec73494b84bf7a8b4dd73bcfc5a307324c76227eb1e67c178d848f32fb59b03206af2a18ee14e22a260a69234790bb56dce419fc0ccea7c594e17673ff3a0a3c160d73926dfdb2d36e7a31c34442bf2fe9806a6cfe1ede9c41a7fd438d8aad76718bbb871575267ccee715f240f130cf4de9874600afc4cfa5ebae7b540fa1a856698d69edc2c89bae8bf6b2e4a2f5a433585d7c8ce5e868648407b4c86f00aa2bdc474ac6ec69160edbe71a2ee09dca31fd80d7224da1d27d7d5a44c7d5a0358cbb18766d2f9fa52d387ab29bf2ac5a63a4e4700b66670e42da58f310031005929abad3b5b262fa3d5b618d38509669733ee587e7723473ddd4f94c02bb9db4bbc013ce5fbc45389b80d0564963e4fa160ebf5dfbeaeea241cbdf485c873b7c4ebd2b8c3d46213355d0cbc697529ad2bac06feb569d58701b9ef4ff428b5792dddeef086bee657ac3841cd1a962993e810de2569bd144e06d15f6676df8d2be7c99b08cac452b93c086137043b3ec00c27dfa3f5017ff2676dc453699ab226caad407ea77a0cece3defd1a1e2f35c62ea42f3e4919c60486459ab3af155c8294849011a5b402f37e9e76c5e4900ec7e210787d5313052722e3dae09416e45a7107b8c911b3d6c9fcfc98680ccb065baa78118379d569462ffd817fed209da9a654541dd19bfb2938c1bba3c61d3ddb533b138d117058fdc2bd3aec3934d8947c9d891cc9573110309d11c730b6261f69f8d273366dba2cbaed07ac42d627a33a8f4aaf60ea60ad0d433869e4d3048753a9d4a9ea55125d45d698f6fe3d842fc4c2a24292d299f54b843e1b3b9c2a50584653a30c49c63206327a74da6c09c21aadc8bb14f5b68a6fe8d4bc96653d1ea1565654ca1bf9fcda2f90e987a694735a277ed38224da402bdb3afcc8aa0eae224edc742e279fe7c595ffb1f84dfdc366c8237fa265ec17a3391b30994f2b6f1402294faa2d434d60fdb2961a1d422b1de25df96fb734a514744cea0e1239e23717f25080bc93217f7563953e4caad6b744480cc5469fc8579f279294ec316bd15898d7665e44b6235ca6b3c5ef5535adfdaec879d6c78cc3a45c5b5a37049fd39e3eedc6824d21134f04d52a1cd9315b4985b73434576a454d013452b3044316aab8caacbdb27acc5cb04f0bbb7b51364852a3c044498edc9a27c8b6f9233ebad51c30f22db5020cb7b90ffc10cb7150d51b458e76311064a1c97d6bec1a8b8bd95e7a308838340994295a3aa3cb7d800abe09122896329a73e6fd0750072677bd11cf956f6cb9a31eb47ea7a090f7729681d8b8b9dd9b13ac5e86015b11ab158639d3355028bf048161cfbff84a6b6bc4309135858cdf57d7c5101f48141dd94e625178e5eaa7579bb2a74ca81972cb5e56f5a09fff62107c5922471203f3eb6d4bd67e6907ffb4bd7f05dd1dc67c0026e35c51065e01cdb390f366c411f22b6ac999974336c88a6f7a59ea1a1870e428d75972e674f0584039a9c9c9389e1116c0db496d2deb349abf1052948c83b7374d0f2a85823a29e9de57d1ee04419097313e6e8c16a307b705db4ccab311db22700ae42e5e7d09eaeb73979837db9557c7b013f32a55c99301dfbb0042afbf1799d5227fec9e4cd836971258066ab0da8c9a3a792002620774e49070935e9e39e1b0f1503f1c08ac6b31bd6f0734673d60fd06c76a7479f1625fd31e6a79d777cf6646a71916958dca5523eb0be353db560091d6e05518859368065de60c7ca3efc3bfa9b8e27cadc508302c24963d96155ff6b8889a6b5bb69772b72d69f2870e8f94b8019203779e0d79711f03948390d47a513bbed3acff5ad335d571a7a6c6a252375db65c37c4e55d5b09108d1488cda4c7ba2caa65b2bf712c5c8c136020202b8759b5b6d49ae5163a37a74445c42b263d5b97790eff8c3f25cd5f84c2dab3d82068d1368f239379213764561bb70aa70811f4b9a142c81f4a97c2ae8496b7faa7379021d1498d5eba0aa6323c03cdc9ada451180be4e87274b905aaaa841646007005d1cab8b5049f23bbc182bd82384b0cd1e667c1b7da8c0daaa63106729e921786773d08409bf9316eaad19b5069caeea0f992e467d2fe576a0a88e0b049b0cec116476285ea320e8fa84430de39514dd2cd4e867a2ce4ce5391e3d57b8e4f4cc60001576fa51107ff6c6b3f3c34d2414780f1b36026540174675a867e5e29957892e977212e5c19a20d47b72cd1c2a1dc157599eb2bad13df351b960da42a2149b036eb6c47b9bc536f2337fb7e99a60eb17860ab01c786a4113ba3bd566166e5ff2f793c6979b4cc74c578a6ef82226dbff82ecd35e83edd54d7581f062b6bf9d68cf77a89f78a67aaf88bff7828d2597058c43d388267916adc02af594bbb547a0dd9f3a7561af7ad9223ce2eb4ec6b54b0755ec5ab5a9f7f023c7deb690518dc12f853058816c63e4bcb3f1bddfa89df47cbe7507afe423691ba086d680abbb924645bcc5307ec5c01d009127f57b6e18ae598c4c69dd72c5180998ee13093981d9a2df2119cc3b25ab7657d539dc35c5eb2bfd71358d98ddaaa6f6bcfb408c3d85ba7848c127e28329c1e3ff1b5ad413d2785a8673509228f79bc8f66c2d1d92c15b7a5b6b9e58401b7243f49543a3c6758f8f2843b1c846a97fc2b8351688ff34c600dca99dbd120463fe2dd08bc5cbec2e3f6b2484b950671d1ebd62ad9472828cc37d6371ff827ae6f6f893a4d8023d801d59729ad3781433eaffbaca7b63772281d063aba126c9e9850ac29132eab2299b02409fcec8e4f710455474e604313680747b7d7b48f16b2e43ee0cffc14f80e892e32c80827a1d4ad0228c5839fa485438e26f59d285ad8322ae018a9d73a970e27563beb5013781690ca3f27ed6cbcfecd8d30a148461ca4a1359cd9fb46017ea434b8ed1fc51d9fe092d8f4fcc63c2b36208fca96c35a8f42b7cde1182ab156e034adaf344c9cb6134de7d4bfc0974052ba848efbfe4c7e141063770c22db82dec8a0530d2079737dd7e3b6899c88edc787aed71aac06c5336d5b9a73a3e703d5aae50fc5418185f79831abbd78dd12a5a52100ad0fe3db9b75cfc1c44d14a9f3843a18b788759b88d9713d8429e508e5300d602c76333239bb0f9dd0b25614d3a91a94b8e1f0485894af887dbb260a002f78bde5e208d8a125f9ce73b6e8c4ff4445cefdb615b0b89f16f7ba28d12a7a0e696b5c25cca16be51e61f3cb832efad00b697cc51b7da23d282f5a7a2f07090208e7f79a0866b86b14540d65ecec95d5a560505e7f2aad1e19e48eed0898561fb8552e6f64ca39ba533627382fd3c2c91fbe9331c8912b27ce1e2f0dd341520c7f21f6f250c347e7824a5549dbb6e6ccda719e18f335f6a7863855c7ddeb4034b9a79ddcca33a86590494417c9f06bae152e41c0628b131202a0f814ff93240259c8c40d0ed22db79762459798b9a153837b47bab4347477928a095eea91970aa4f22032da90e0e9283da3a44ef01340dcf58181cfe42849ff68b57dc57ca7268d3517d90760d61ce896b3ea6e53f887505ed81b8f2c2ecf81d164b90731180b"


	data = bytes.fromhex(tx_raw)

	#data = b'\x02\x18\xeap\xa1~\x8c\xbf\xd7\xc4\xa3\x97z\xd0\x14\xa6\xbdZ\xab\xfa\x1f\x03h\n\x0f\xd5\x9c\xcf\x80\x99(\xc4\x06C\x111.0\xf5\x94\x8b:\xd8\xc7\x00\xfe\x86\x0eVI\x10LW\x99\xa5\xb9\xeeF\t)&9\xa7\xa7?\xde4\x1e\x82\x92\xdc\x88\x987\xe6\x15\xfc_\xc9\xdbL\x14> \xc5\x1eu\x15|\xce\x9a\xf4\x0e\x14DT\xbd\x9b\x9fty\x03o\xa6\x9eAQ\n\xa6C^|\x00HP\xa3\x0e1k\xa3~\xa0\xe2\xf8O\xad\x93&;\xcc\x7f!\xb3\xc1\x18\xb6\xde8\xd5P\xe3U"\xb74B\xcc\x18K\xaf}y\xf7\x93\x87|\xef.>\xbb\x8bh\xd5\x94\x8e>\xf9\xdf5\xaa\xec\t1\x03\x94\xaaX\xfc\x90\xe6M\xbau\xc0\x05\xf8To\xa0\xd1\xe0\xbd\xd8\x14\x0e\xe1Yu\xade\xd9N\x93\xa3lA\xacD\xcd<\x85\xc5\xe9s1\xc9\xd6u\xd2h\r\xe5>\x02Zkj\xadwS\x18l\x12\xef4\x8d\x16[\xe6mk|.\x06\xe6cG\xcb\xc7`\x1ab\xbbS\xf0U\xdb\x9b#&\xfe\x1e\xa2\x120\xed\xfdp\x0b\xc4/\xed\xc6\x88\xc8\xecO\xf2wz\x7f\xad?\x19)\xdf\xc1\r\xb0U~5\xba\xb1q\x89\x15\xbd\x1fG\n\xb1U\xcc\xee\xe7\x94\xe6\xe4i\x0e\x93\xac\x1c\x99E\x8f`\x88d#\xb0#\x8f\xeb\xcad\xbf@TiL2Z\xfe~\x997\x1c\x12\x1b\x1c;1\x1f\t\x8f\xfd\x16\xd5\x85\xc05E\x03\x87R\x7f|\xde\x11)$\x0fe\x91\xe5Q5_0\x8a>\xc4\xd1\xa79\xb69\xac\'B^\xbc\xf1\xa4\xf1,\x1dE\xbb\xd0Z\x96\xc5\x06\xb1\xb9\xfa\x06\xfc\x18:\x92\x81\x83\xfddy\x1b\xe8\x85\xf8Qk\x07RS\x8b\x8cD\x117\xf7}\x07N\xc8\x1e9h\xc6\x0e\x06P\n\x07VM\x92\xd4\xba\xa7\x88G\xe9\xa4\x8c5\xb4\x0f\xd3\xe6\x12\xc2STv\xfc\xf3\xc7\xc45\x97\x1be\xe0h`\x1aT\x1dW\xfe\xbd\x985\\\xc0\xa8\xe1U\x1a\xa8f\xc0\xb6\x03\x03\x00z\xdcn\xe2\xa3\xc13\x1b\x97\xf9\xcbA\x0c2M\xb4*\x90[c\xcb\x1b\x9c\xc9A\xb0_*X\xde\xc5\xe5\xe0\x97\xf0\x03\x8a\x99J`\xcc\xe72{]&?*\x0f\x97v\xda\x91\xb3\xe8\xc1\xc94\xfe)\\\x0b+|\x9d%\xf6\x17\xc6]\xbfXn\x1d\x03\xe8\xb3\x03E\x11\x05Q\xa9\xba\xfe;\xbc~\xa4\x87\xb8us\xeb%\x83\xc2\xb5Y\xff\xf8D\x96\x16\x1bD\xeb\xc3\x19\x9a\xec\xca(\xca\xb3\xc8\xef\xf3A\xad^\xb0\xbc\xb6\xaaY\xe9\xaa\x93\x01\x98B\xc5\x19g*\x97\x97\xf9\x94\xbf/a\xc0[\x0e\x8e"\xc7N\x93\x1d^\xf8&\xc18\xe4\xae2D\x83f9C\xd9\xc7\xdc)6,\xf5\x1e,\xa3V3\x9f\xdeO\xc7\x16\x93\xcbu\xe8\x7f\xd4\xe3\xc9\xb5\xed\xfa;\x8bc&\x99\x85&N\x17\xc4\xfc\xeb\x8a]\xa6\x8f\x946\xc8Y\x91\x8e(1\xe5\xf9\xf0D\xe5F\xa4\x89\xef\xa3\x9a\xf3V#\xc0\xf0!\xa4\xeb\x03G\xfa\xe0)5\x1eY\x9f8G\xf6*\xe6\x01\x18\xbe\xb5(\x9b+B\xcd\t>\xc9\x14\xf17\x1d\xac\x9f\xd5\xa5b\xde"\xbb\x12g\x8f\x14/\xd9g9\xa4\xfe\x86L\xa72\xa0\xf6DJ,f#\x0e ZEd\x03\xd3\xcf\xda9\x85\xe5\\\x168\t\x17\xf0j\xfa\x14J\xa0\xb1\x1f\xa9\xec\x9bs\xd9\x01\xac\xc7\x06}\x12\x07F\xea\xcd\xeb\xc2\xa1oT\x0e\xc1\xf0\xda-\x1cy\x9a\xc3\xda\xf0\xc9\x08\xb2a\xf26\x97\xe4\x02\xb4\x0f\x95c\'g\xd1\xd2\x03\xbaX\x89\xde\xf6}\xa1s\x80{yX\xc0\x8d\x999\x85h\x13\x03\xd3\x90\xed\xccS\x07 ^|\x92\xf4.\xf89\xe1\x87d\xd0\x86\xd0\xae\xd8\xc0M\xa9\x04}:\x87\xad\x8d1\xd4jL\xc9u\x8d\x16\x12W.\xfb\x16^\\8\x05\xd3\x08\x97\xf4\x04\tn\x96\xb5*\x83\xca\x9e\x10#\x0f:\xc1\xfbEm7\xb1\xa8\xe0\xbb\x04\xcdw\xbdd\x17H\xaa\xb7\x86\xb9\xf2\xb2\x9e\xa9\xd2\x1d\x84:\xd3\x04\rj\x13\x84\xfd\xb66\xb4\x93\x07\xc0\xfb\xc7\x91\xab\xe8\xd6\x89\x7f\x10\xa8\xc7\x8d\xfc\xf5\xda\xfa\xf3H\x16#m\xb6\xc7\xaf\xbar\xeb\xff\xd4\xef\x04e\xe6\x9c\xae\x1e\x927\xd1\x05D\x1dS\\K\xcc4\xf8(\xf2\x19T|\xc0\x8a\xf3\xe0\x93\x19\xc9\xf3\x1e\x85\xb1\xc5\x9dC\xca\xffW`\xa8\xe8\xc0\xad\xaf)\x05\xb8\x92\xf2\x19iKE\xa9\x05;\xe1\x124\x99\x8d]\xfdWj\xea\xbeE@Dv\xb0\\\x08{i\xc4\n\xe1jP\x17Q\x88\x81b\xe9\xb3\xffN\xdf<\x9d;\x7f%\x9a\x82\x1c\xe0Q\xcf\xef\t_5 \x97N\xaa\x8b\\\xcb\xb4\xe5V\xe6\xe2\xcb"%\x1f#\xec\xd0f\x18\x9f\xbd\xc9b\xdc=\r\xb2\x99\xb6\xeb\x05^\x14\xd8\xd8V\xf7\xb5M\xcb\xa7\xa9\xcar\xc0\nm\x03U\xc9\x8c\xea\x0f\x8e\xad<%\x84\xfe\xa1\xf6\x0eI\xab(\xce\xb1F-68=o\x849\x8a\x8e\xfdo/\xc5\xc1\xa2pp\xfa\x96\xd7\x8d\x1c\x8fZ\xe1G\x06\x10\x8aZ\xbb0\xd6\xb1l8Q\xe3\xb9|\xd8@\xcd?v$\x93\xb2\x95C\x87:\x92\x8fV\xc0\x9a\xc3R\x87\xa1Z\xdc\xe8\x84<\xf2\x1cvnY)\x03v\x90\xe4\xc1\xca\x1b\xbb\x88\x1e\x95\x17\x02$\xd8V0~x\x01X1\x8e\x12\x81\xb7\x8a7u\xd4\xad\x03\x01r\xbd\xd8ML|\x88G\xfd\x88\xb8\x1c?\xc31|?\xb0HaIx\x16B\xb4\xe1ff1\x02\xb0\xac\xb2\xee\xc3P\x97;\xdb\x1b\xd0\xc1\xcf\x80\xdc\xedb\x0cT$\xbc\xcc\x97\xc7\xa9l\xbb\x9c{\x1b\xb3\xdb\xe8\xc7\xfc\x1dl\x8e\xf9?|\xd9\xd4?\xfd\xc3\x82\x1eN\x0ezG\x97\xca\xc9\x8d\x8cj)J7Ds\x12S\x8c\xfc\x0b\xaa\x03\x08\xbeK_\x17\x0c \xce\xa8J\xfeaTf\x1cY\xfaL\xff\x01\xb0\x99\xbd.\\\xe9d\x03g\xcfOJ\xe2y\xfc\x1f\xd1;\xd0\xe4\xf3\xbc\x8f\x81\xab9\xfbF\xc8%\x06\xcbs\xdb\x93\xcc\xa5\x01\x0e_$O\x91\xac\xef\xfc\xfd\xd4W\xf0\xaf\xb1K2M\xc6\xaa\xe6DE\xe5\x86\x835\x01\x82\x9e\xf8\xb3\x1c\x19\xca\xdb\xcfR\xed\xab?OZ\xea\x0c>9\xde\xf9B0Q(\xfcp\xa6\x82^\x1a\xbdM\xb7\xa6\xe8|kb\x0eXr\xc8\xd2%\to43v\x94\xd9~\x8e\x93\xacg\xe3E\t\x12\x0c\xf8.\xe8\xb2\x99H\xaeZ\xd1!\x15)\x8d&\xc0\x0f\xfew\x1c2\x0eKM\xb2<\x1a\xa1S\x80\xa5\xd7\xc3\xdc\x0b>\xaa\xfa\xc56F\x94\xba\r\x1f\xd78\x9e\x9e\xce\x8a\xab]\xc7\xf1\xc8\xd7\x86\xc3\x96\xa5\xef\xf8\xd4\xfe\xab\x84\xa6E\x83EY+p\x88<1}\x16a\x08\n\x82\xbe\xf1a\x19rGo;\xcd\xa3\xe2K#\x8c'

	r = Reader(data)
	parsed = parse_tx(r)
	#parsed = [parse_action(r) for _ in range(r.compact())]
	import yaml
	print(yaml.dump(parsed, sort_keys=False))
	print()
	print("remaining data:", r.remaining())
